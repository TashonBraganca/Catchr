import{r as a,j as e,m as r,a as f,A as v}from"./index-CsoB02sa.js";const Y=({onTranscriptComplete:w,onError:d,className:G})=>{const[c,S]=a.useState(!1),[h,W]=a.useState(!1),[R,N]=a.useState(""),[F,I]=a.useState(0),[n,B]=a.useState(0),[H,L]=a.useState(0),[x,A]=a.useState("listening"),[C,q]=a.useState(!1),[g,U]=a.useState([]),b=a.useRef(null),k=a.useRef(null),j=a.useRef([]),T=a.useRef(null),M=a.useRef(null),P=a.useRef(),z=a.useCallback(()=>{if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){const s=window.SpeechRecognition||window.webkitSpeechRecognition,t=new s;return t.continuous=!0,t.interimResults=!0,t.lang="en-US",t.onresult=i=>{let o="",u=0,l=0,m="";for(let p=i.resultIndex;p<i.results.length;p++)i.results[p].isFinal?(o+=i.results[p][0].transcript,u+=i.results[p][0].confidence||.8,l++):m+=i.results[p][0].transcript;const O=o+m;if(O){const p=O.split(" ").filter(y=>y.length>0);U(p)}if(o){const p=o;N(y=>y+p),L(y=>y+p.split(" ").filter(Q=>Q.length>0).length),l>0&&(B(u/l),u/l<.6&&q(!0))}},t.onerror=i=>{console.warn("Speech recognition error:",i.error)},t}return null},[]),D=a.useCallback(()=>{if(!M.current)return;const s=M.current,t=new Uint8Array(s.frequencyBinCount),i=()=>{s.getByteFrequencyData(t);const o=t.reduce((u,l)=>u+l,0)/t.length;I(o/255),c&&(P.current=requestAnimationFrame(i))};i()},[c]),V=a.useCallback(async()=>{try{S(!0),N(""),j.current=[];const s=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),t=new AudioContext,i=t.createMediaStreamSource(s),o=t.createAnalyser();o.fftSize=256,i.connect(o),T.current=t,M.current=o,D();const u=z();u&&(k.current=u,u.start());const l=new MediaRecorder(s,{mimeType:"audio/webm;codecs=opus"});l.ondataavailable=m=>{m.data.size>0&&j.current.push(m.data)},b.current=l,l.start(100)}catch(s){console.error("Error starting recording:",s),d==null||d("Failed to access microphone"),S(!1)}},[z,D,d]),$=a.useCallback(async()=>{S(!1),W(!0),k.current&&k.current.stop(),b.current&&b.current.state!=="inactive"&&b.current.stop(),T.current&&T.current.close(),P.current&&cancelAnimationFrame(P.current);try{A("transcribing");let s=R;if((!s||s.length<10)&&j.current.length>0){const t=new Blob(j.current,{type:"audio/webm"});s=await J(t)}if(s&&s.length>0){A("processing");const t=await _(s);w==null||w(s,t.suggestedTitle,t.suggestedTags)}else d==null||d("No speech detected")}catch(s){console.error("Error processing recording:",s),d==null||d("Failed to process recording")}finally{W(!1),N(""),I(0),B(0),L(0),A("completed")}},[R,w,d]),J=async s=>{const t=new FormData;t.append("audio",s,"recording.webm");const i=await fetch("/api/voice/transcribe",{method:"POST",body:t});if(!i.ok)throw new Error("Whisper transcription failed");return(await i.json()).transcript||""},_=async s=>{const t=await fetch("/api/voice/categorize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:s})});if(!t.ok)throw new Error("GPT processing failed");return await t.json()},K=()=>{const s=Array.from({length:12},(t,i)=>{if(!c)return 4;const o=F*40,u=Math.sin(Date.now()*.005+i*.5)*8,l=[1,.8,1.2,.9,1.1,.7,1.3,.8,1.1,.9,1.2,.8][i];return Math.max(4,o*l+u)});return e.jsx("div",{className:"flex items-center space-x-1",children:s.map((t,i)=>e.jsx(r.div,{className:f("w-1 rounded-full transition-colors duration-200",n>.8?"bg-green-500":n>.6?"bg-[#007aff]":n>0?"bg-yellow-500":"bg-[#007aff]"),animate:{height:t},transition:{duration:.1,ease:"easeOut"},style:{height:Math.round(t)}},i))})};return e.jsxs(r.div,{className:f("flex flex-col items-center space-y-4 p-6 bg-white rounded-2xl border border-[#e5e5e7]","shadow-sm",G),initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},children:[e.jsx(r.button,{"data-testid":"voice-record-button","aria-label":c?"Stop recording":"Start recording",className:f("relative w-20 h-20 rounded-full border-4 transition-all duration-200","flex items-center justify-center",c?"bg-[#ff3b30] border-[#ff3b30] text-white":"bg-white border-[#007aff] text-[#007aff] hover:bg-[#007aff]/5",h&&"opacity-50 cursor-not-allowed"),onClick:c?$:V,disabled:h,whileTap:{scale:.95},whileHover:{scale:h?1:1.05},children:e.jsx(v,{mode:"wait",children:h?e.jsx(r.div,{className:"w-6 h-6 border-2 border-current border-t-transparent rounded-full animate-spin",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}):c?e.jsx(r.div,{className:"w-6 h-6 bg-white rounded-sm",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8}}):e.jsxs(r.svg,{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:[e.jsx("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),e.jsx("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})})}),e.jsxs("div",{className:"text-center",children:[e.jsx(r.p,{"data-testid":"voice-status",className:"text-lg font-medium text-[#1d1d1f]",animate:{scale:c?1.05:1},children:h?x==="transcribing"?"Transcribing...":x==="processing"?"Processing with AI...":"Processing...":c?"Recording...":"Tap to record"}),e.jsxs("div",{className:"text-sm text-[#8e8e93] mt-1 space-y-1",children:[e.jsx("p",{children:h?x==="transcribing"?"Converting speech to text with Whisper AI":x==="processing"?"Analyzing content with GPT-5-mini":"Processing audio...":c?"Speak naturally - I'm listening":"Tap to start voice capture"}),c&&g.length>0&&e.jsxs(r.div,{className:"space-y-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-xs",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"📝"}),e.jsxs("span",{children:[g.length," words"]})]}),n>0&&e.jsxs(r.span,{className:f("flex items-center space-x-1 px-2 py-1 rounded-full",n>.8?"bg-green-100 text-green-700":n>.6?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"),animate:{scale:n<.6?[1,1.05,1]:1},transition:{duration:.5,repeat:n<.6?1/0:0},children:[e.jsx("span",{children:n>.8?"🟢":n>.6?"🔵":"🟡"}),e.jsxs("span",{children:[Math.round(n*100),"%"]})]}),e.jsx("button",{onClick:()=>q(!C),className:"text-[#007aff] hover:text-[#0051d5] transition-colors","aria-label":"Toggle advanced statistics",children:C?"📊 Less":"📈 More"})]}),e.jsx(v,{children:C&&e.jsxs(r.div,{className:"flex items-center justify-center space-x-3 text-xs text-[#8e8e93] p-2 bg-[#f8f9fa] rounded-lg",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsxs("span",{children:["⏱️ ",Math.floor(g.length/2.5),"/min"]}),e.jsxs("span",{children:["🎚️ ",Math.round(F*100),"% level"]}),e.jsxs("span",{children:["🧠 ",x]})]})})]})]})]}),e.jsx(v,{children:(c||h)&&e.jsx(r.div,{className:"flex items-center justify-center h-8",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:e.jsx(K,{})})}),e.jsx(v,{children:R&&c&&e.jsxs(r.div,{className:"w-full max-w-md p-4 liquid-glass liquid-glass--rounded-lg",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-[#007aff]",children:"🎤 Live transcript"}),n>0&&e.jsxs("div",{className:f("flex items-center space-x-1 text-xs px-2 py-1 rounded-full",n>.8?"bg-green-100 text-green-700":n>.6?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:[e.jsx("span",{children:n>.8?"🟢":n>.6?"🟡":"🔴"}),e.jsxs("span",{children:[Math.round(n*100),"%"]})]})]}),e.jsxs("div",{className:"text-sm text-[#1d1d1f] leading-relaxed mb-2",children:[g.map((s,t)=>e.jsx(r.span,{className:f("inline-block mr-1",t>=g.length-3?"text-[#007aff] font-medium":""),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2,delay:t*.05},children:s},`${s}-${t}`)),e.jsx(r.span,{className:"inline-block w-0.5 h-4 bg-[#007aff] ml-1",animate:{opacity:[1,0,1]},transition:{duration:1,repeat:1/0}})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-[#8e8e93] pt-2 border-t border-[#e5e5e7]",children:[e.jsxs("span",{children:[H," words captured"]}),e.jsx("span",{children:"Auto-saving in 1s"})]})]})})]})};export{Y as SimpleVoiceCapture,Y as default};
//# sourceMappingURL=SimpleVoiceCapture-DwlCgo9q.js.map
